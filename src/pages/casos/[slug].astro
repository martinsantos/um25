---
import Layout from '../../layouts/Layout.astro';
import { getCasoBySlug, getAllCasos, getCasosRelacionados } from '../../data/casos';
import type { GetStaticPaths } from 'astro';
import OptimizedImage from '../../components/OptimizedImage.astro';

export const getStaticPaths = (() => {
    const casos = getAllCasos();
    return casos.map(caso => ({
        params: { slug: caso.slug },
    }));
}) satisfies GetStaticPaths;

const { slug } = Astro.params;
const caso = getCasoBySlug(slug || '');
const casosRelacionados = getCasosRelacionados(slug || '');

if (!caso) return Astro.redirect('/404');
---

<Layout title={`${caso.titulo} | Ultima Milla`} description={caso.descripcionCorta}>
    <main class="container mx-auto px-4 py-8">
        <!-- Hero Section -->
        <div class="relative h-[400px] mb-8 rounded-xl overflow-hidden">
            <OptimizedImage
                src={caso.imagen}
                alt={caso.titulo}
                class="w-full h-full object-cover"
                loading="eager"
            />
            <div class="absolute inset-0 bg-gradient-to-r from-black/70 to-black/30 flex items-center">
                <div class="container mx-auto px-4">
                    <div class="text-white/80 mb-2">{caso.industria}</div>
                    <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">
                        {caso.titulo}
                    </h1>
                    <p class="text-xl text-white/90 max-w-2xl">
                        {caso.descripcionCorta}
                    </p>
                </div>
            </div>
        </div>

        <!-- Contenido Principal -->
        <div class="grid md:grid-cols-3 gap-8">
            <div class="md:col-span-2">
                <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                    <h2 class="text-2xl font-bold mb-6">Sobre el Proyecto</h2>
                    <p class="text-gray-700 mb-8">{caso.descripcionLarga}</p>

                    <div class="space-y-8">
                        <div>
                            <h3 class="text-xl font-semibold mb-3">El Desafío</h3>
                            <p class="text-gray-700">{caso.desafio}</p>
                        </div>

                        <div>
                            <h3 class="text-xl font-semibold mb-3">Nuestra Solución</h3>
                            <p class="text-gray-700">{caso.solucion}</p>
                        </div>

                        <div>
                            <h3 class="text-xl font-semibold mb-3">Resultados Clave</h3>
                            <ul class="list-disc list-inside space-y-2">
                                {caso.resultados.map(resultado => (
                                    <li class="text-gray-700">{resultado}</li>
                                ))}
                            </ul>
                        </div>
                    </div>
                </div>

                {caso.testimonial && (
                    <div class="bg-primary-50 rounded-xl shadow-lg p-8">
                        <blockquote class="text-lg text-gray-700 italic mb-4">
                            "{caso.testimonial.texto}"
                        </blockquote>
                        <div class="flex items-center">
                            <div>
                                <div class="font-semibold text-gray-900">
                                    {caso.testimonial.autor}
                                </div>
                                <div class="text-gray-600">
                                    {caso.testimonial.cargo}
                                </div>
                            </div>
                        </div>
                    </div>
                )}
            </div>

            <!-- Sidebar -->
            <div>
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <h3 class="text-xl font-semibold mb-4">Detalles del Proyecto</h3>
                    <div class="space-y-4">
                        <div>
                            <div class="text-gray-600 mb-1">Cliente</div>
                            <div class="font-medium">{caso.cliente}</div>
                        </div>
                        <div>
                            <div class="text-gray-600 mb-1">Industria</div>
                            <div class="font-medium">{caso.industria}</div>
                        </div>
                        <div>
                            <div class="text-gray-600 mb-1">Tecnologías Utilizadas</div>
                            <div class="flex flex-wrap gap-2">
                                {caso.tecnologiasUsadas.map(tech => (
                                    <span class="px-3 py-1 bg-primary-100 text-primary-700 rounded-full text-sm">
                                        {tech}
                                    </span>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CTA -->
                <div class="bg-primary-600 text-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold mb-4">¿Te gustaría un resultado similar?</h3>
                    <p class="mb-4">Contáctanos para discutir cómo podemos ayudarte con tu proyecto.</p>
                    <a
                        href="/contacto"
                        class="block text-center bg-white text-primary-600 py-2 px-4 rounded-lg font-semibold hover:bg-primary-50 transition-colors"
                    >
                        Contactar Ahora
                    </a>
                </div>
            </div>
        </div>

        <!-- Casos Relacionados -->
        {casosRelacionados.length > 0 && (
            <div class="mt-12">
                <h2 class="text-2xl font-bold mb-6">Casos de Éxito Relacionados</h2>
                <div class="grid md:grid-cols-3 gap-6">
                    {casosRelacionados.map(caso => (
                        <a
                            href={`/casos/${caso.slug}`}
                            class="block bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow"
                        >
                            <OptimizedImage
                                src={caso.imagen}
                                alt={caso.titulo}
                                class="w-full h-48 object-cover"
                            />
                            <div class="p-6">
                                <div class="text-sm text-gray-600 mb-2">{caso.industria}</div>
                                <h3 class="text-xl font-semibold mb-2">{caso.titulo}</h3>
                                <p class="text-gray-600">{caso.descripcionCorta}</p>
                            </div>
                        </a>
                    ))}
                </div>
            </div>
        )}
    </main>
</Layout>
